name: Foundations

on:
  workflow_dispatch:
  # pull_request:
  #   branches:
  #     - develop
  #   paths:
  #     - bicep/deploy/foundations/* 
  # push:
  #   branches:
  #     - develop
  #   paths:
  #     - bicep/deploy/foundations/* 

env:
  workflow-file-name: build.yml  
  bicep-file-path: ./bicep/deploy/foundations/deploy.bicep@develop

jobs:  
  build:
    #if: ${{ contains(github.ref, 'refs/pull/') }}   
    uses: ./.github/workflows/build.yml
    with:
      variable-path: ./.github/variables/*
      bicep-file-path: ${{ env.bicep-file-path }}
    
    # runs-on: ubuntu-latest
    # steps:
    #   - name: Checkout Repo
    #     uses: actions/checkout@v2

    #   - name: Build Bicep Code
    #     uses: ./.github/actions/build
    #     with:         
    #       bicep-file-path: ${{ env.bicep-file-path }}

  deploy:
    needs: build
    # if: ${{ github.ref == 'refs/heads/main' }}        
    uses: ./.github/workflows/deploy.yml@develop
    with:
      azure-credentials: ${{ secrets[env.AZURE_CREDENTIALS] }}          
      workflow-file-name: ${{ env.workflow-file-name }}
      variable-path: ./drop/.github/variables/* 

    # runs-on: ubuntu-latest
    # steps:
    #   - name: Checkout Repo
    #     uses: actions/checkout@v2

    #   - name: Set Environment Variables
    #     uses: tw3lveparsecs/github-actions-set-variables@v0.1

    #   - name: Deploy Bicep Code
    #     uses: ./.github/actions/deploy
    #     with:
          # azure-credentials: ${{ secrets[env.AZURE_CREDENTIALS] }}          
          # workflow-file-name: ${{ env.workflow-file-name }}
          # variable-path: ./drop/.github/variables/*      